<!DOCTYPE html>
<html lang="nl">
<link rel="stylesheet" href="/css/leiding_editor.css">
<%- include('../partials/head') %>

    <body>
        <%- include('../partials/header') %>

            <main class="container my-5"">
                <div class="row">
                    <div class="col-md-5">
                        <div class="card shadow">
                            <div
                                class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">Huidige leiding</h4>
                                <button type="button" class="btn btn-light btn-sm" id="btnAddNew">
                                    <i class="bi bi-plus-lg"></i>
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <% if (leidingList && leidingList.length> 0) { %>
                                    <div class="list-group list-group-flush" id="leidingList" data-selected-id="<%= selectedId || '' %>">
                                        <% leidingList.forEach(l=> { %>
                                            <a href="#" class="list-group-item list-group-item-action leiding-item<%= selectedId && selectedId === l._id.toString() ? ' active' : '' %>"
                                                data-id="<%= l._id %>" 
                                                data-name="<%= l.name %>"
                                                data-phone="<%= l.phone %>" 
                                                data-email="<%= l.email %>"
                                                data-bio="<%= l.bio %>" 
                                                data-group="<%= l.group || '' %>"
                                                data-image-url="<%= l.imageUrl || '' %>"
                                                data-is-hoofdleiding="<%= l.isHoofdleiding %>"
                                                data-image-public-id="<%= l.imagePublicId || '' %>">
                                                <div class="d-flex align-items-center">
                                                    <% if (l.imageUrl) { %>
                                                        <img src="<%= l.imageUrl %>" alt="<%= l.name %>"
                                                            class="rounded-circle me-3"
                                                            style="width: 50px; height: 50px; object-fit: cover;">
                                                        <% } else { %>
                                                            <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-3"
                                                                style="width: 50px; height: 50px;">
                                                                <i class="bi bi-person-fill"></i>
                                                            </div>
                                                            <% } %>
                                                                <div>
                                                                    <h6 class="mb-0">
                                                                        <%= l.name %>
                                                                    </h6>
                                                                    <small class="text-muted">
                                                                        <%= l.group || 'Onbekend' %> â€¢ <%= l.email %>
                                                                    </small>
                                                                </div>
                                                </div>
                                            </a>
                                            <% }); %>
                                    </div>
                                    <% } else { %>
                                        <div class="p-4 text-center text-muted">
                                            <i class="bi bi-people" style="font-size: 3rem;"></i>
                                            <p class="mt-3 mb-0">Nog geen leiding toegevoegd</p>
                                        </div>
                                        <% } %>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0" id="formTitle">Nieuwe leiding toevoegen</h4>
                            </div>
                            <div class="card-body">
                                <form id="leidingForm" method="POST" action="/leiding/admin"
                                    enctype="multipart/form-data">
                                    <input type="hidden" id="leidingId" name="leidingId" value="">
                                    <input type="hidden" id="formMode" value="create">

                                    <div class="mb-3">
                                        <label for="name" class="form-label">Naam *</label>
                                        <input type="text" class="form-control" id="name" name="name" required
                                            placeholder="">
                                    </div>

                                    <div class="mb-3">
                                        <label for="group" class="form-label">Groep *</label>
                                        <select class="form-select" id="group" name="group" required>
                                            <% if (Array.isArray(groups) && groups.length) { %>
                                                <% groups.forEach(group => { %>
                                                    <option value="<%= group %>"><%= group %></option>
                                                <% }); %>
                                            <% } %>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="phone" class="form-label">Telefoonnummer *</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" required
                                            placeholder="Bv. 0499 12 34 56">
                                    </div>

                                    <div class="mb-3">
                                        <label for="email" class="form-label">E-mail *</label>
                                        <input type="email" class="form-control" id="email" name="email" required
                                            placeholder="">
                                    </div>

                                    <div class="mb-3">
                                        <label for="bio" class="form-label">Bio *</label>
                                        <textarea class="form-control" id="bio" name="bio" rows="4" required
                                            placeholder="Korte beschrijving..."></textarea>
                                    </div>

                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="isHoofdleiding"
                                            name="isHoofdleiding">
                                        <label class="form-check-label" for="isHoofdleiding">
                                            Hoofdleiding
                                        </label>
                                    </div>

                                    <div>
                                        <label for="image" class="form-label">Profielfoto (optioneel)</label>
                                    </div>
                                    <div class="mb-3 p-3 border rounded text-center">
                                        <input type="hidden" name="existingImageUrl" id="existingImageUrl" value="">
                                        <input type="hidden" name="existingImagePublicId" id="existingImagePublicId" value="">
                                        <input type="hidden" name="imageRemoved" id="imageRemoved" value="false">

                                        <div id="imageUploadSection">
                                            <input type="file" class="form-control mx-auto" id="image" name="image"
                                                accept="image/jpeg,image/png,image/webp">
                                            <div class="form-text">( Max 5MB - JPG, PNG of WEBP )</div>
                                        </div>

                                        <div id="imageDisplaySection" style="display: none;">
                                            <label class="form-label d-block mb-3">Huidige foto</label>
                                            <img id="previewImage" alt="Profielfoto"
                                                class="img-thumbnail d-block mb-3 mx-auto"
                                                style="max-width: 150px; max-height: 150px;">
                                            <button type="button" class="btn btn-sm btn-outline-danger mx-auto"
                                                id="btnRemoveImage">
                                                <i class="bi bi-trash me-1"></i> Verwijderen
                                            </button>
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-secondary" id="btnDelete"
                                            style="display: none;">
                                            Verwijderen
                                        </button>
                                        <button type="submit" class="btn btn-primary flex-grow-1" id="btnSubmit">
                                            Toevoegen
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <%- include('../partials/footer') %>

                <script src="/js/leiding-editor.js"></script>
    </body>

</html>